<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sistem Absensi Siswa</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 15px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
        }

        .nav-tabs {
            display: flex;
            justify-content: center;
            gap: 10px;
            margin-bottom: 20px;
            width: 100%;
            max-width: 1000px;
        }

        .tab-btn {
            background: white;
            border: none;
            padding: 15px 40px;
            border-radius: 12px;
            font-size: 17px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
        }

        .tab-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 25px rgba(0,0,0,0.2);
        }

        .tab-btn.active {
            background: #667eea;
            color: white;
            transform: translateY(-2px);
        }

        .container {
            background: white;
            border-radius: 20px;
            padding: 35px 50px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            width: 90vw;
            max-width: 950px;
            height: 75vh;
            max-height: 650px;
            margin: 0 auto;
            overflow-y: auto;
            position: relative;
        }

        .school-logo {
            position: absolute;
            top: 25px;
            left: 35px;
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .school-logo-icon {
            width: 50px;
            height: 50px;
            background: white;
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            overflow: hidden;
            box-shadow: 0 4px 15px rgba(0,0,0,0.15);
            animation: logoFloat 3s ease-in-out infinite;
        }

        @keyframes logoFloat {
            0%, 100% { transform: translateY(0px) rotate(0deg); }
            50% { transform: translateY(-5px) rotate(3deg); }
        }

        .school-logo-icon img {
            width: 100%;
            height: 100%;
            object-fit: contain;
            padding: 5px;
        }

        .school-name {
            display: flex;
            flex-direction: column;
        }

        .school-name-main {
            font-size: 16px;
            font-weight: 700;
            color: #667eea;
            line-height: 1.2;
        }

        .school-name-sub {
            font-size: 12px;
            color: #999;
            font-weight: 500;
        }

        .dashboard-container {
            background: white;
            border-radius: 20px;
            padding: 35px 50px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            width: 95vw;
            max-width: 1400px;
            height: 80vh;
            max-height: 750px;
            margin: 0 auto;
            overflow-y: auto;
            position: relative;
        }

        .page {
            display: none;
            opacity: 0;
            transform: scale(0.98);
            transition: opacity 0.3s ease, transform 0.3s ease;
        }

        .page.active {
            display: block;
            opacity: 1;
            transform: scale(1);
        }

        .page.fade-out {
            opacity: 0;
            transform: scale(0.98);
        }

        .logo-transition-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100vw;
            height: 100vh;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 9999;
            opacity: 0;
            transition: opacity 0.2s ease;
        }

        .logo-transition-overlay.active {
            display: flex;
            opacity: 1;
        }

        .logo-transition-overlay img {
            width: 80px;
            height: 80px;
            object-fit: contain;
            animation: logoTransitionZoom 0.5s ease;
        }

        @keyframes logoTransitionZoom {
            0% { 
                transform: scale(0.8); 
                opacity: 0; 
            }
            50% { 
                transform: scale(1.1); 
                opacity: 1; 
            }
            100% { 
                transform: scale(0.8); 
                opacity: 0; 
            }
        }

        h1 {
            text-align: center;
            color: #667eea;
            margin-bottom: 25px;
            margin-top: 30px;
            font-size: 32px;
        }

        .step {
            display: none;
            opacity: 0;
            transition: opacity 0.3s ease, transform 0.3s ease;
            transform: translateY(20px);
        }

        .step.active {
            display: block;
            opacity: 1;
            transform: translateY(0);
        }

        @keyframes fadeIn {
            from { 
                opacity: 0; 
                transform: translateY(20px); 
            }
            to { 
                opacity: 1; 
                transform: translateY(0); 
            }
        }

        label {
            display: block;
            margin-bottom: 15px;
            color: #333;
            font-weight: 600;
            font-size: 18px;
        }

        .name-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 15px;
            margin: 20px 0;
            max-height: 450px;
            overflow-y: auto;
        }

        .name-btn {
            background: #f5f5f5;
            border: 3px solid transparent;
            border-radius: 12px;
            padding: 20px 15px;
            font-size: 17px;
            cursor: pointer;
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            text-align: center;
            font-weight: 500;
            position: relative;
            overflow: hidden;
        }

        .name-btn::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 0;
            height: 0;
            border-radius: 50%;
            background: rgba(102, 126, 234, 0.2);
            transform: translate(-50%, -50%);
            transition: width 0.6s, height 0.6s;
        }

        .name-btn:hover::before {
            width: 300px;
            height: 300px;
        }

        .name-btn:hover {
            background: #e8e8e8;
            transform: translateY(-6px) scale(1.02);
            box-shadow: 0 12px 30px rgba(102, 126, 234, 0.3);
        }

        .name-btn.selected {
            border-color: #667eea;
            background: linear-gradient(135deg, #f0f4ff 0%, #e0e7ff 100%);
            color: #667eea;
            animation: selectPulse 0.5s ease;
        }

        @keyframes selectPulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }

        .emoji-grid {
            display: grid;
            grid-template-columns: repeat(6, 1fr);
            gap: 20px;
            margin: 25px 0;
        }

        .emoji-btn {
            background: linear-gradient(135deg, #ffeaa7 0%, #fdcb6e 100%);
            border: 3px solid transparent;
            border-radius: 20px;
            padding: 30px;
            font-size: 55px;
            cursor: pointer;
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
            position: relative;
            overflow: hidden;
            animation: float 3s ease-in-out infinite;
        }

        .emoji-btn:nth-child(1) { animation-delay: 0s; }
        .emoji-btn:nth-child(2) { animation-delay: 0.5s; }
        .emoji-btn:nth-child(3) { animation-delay: 1s; }
        .emoji-btn:nth-child(4) { animation-delay: 1.5s; }
        .emoji-btn:nth-child(5) { animation-delay: 2s; }
        .emoji-btn:nth-child(6) { animation-delay: 2.5s; }

        @keyframes float {
            0%, 100% { transform: translateY(0px); }
            50% { transform: translateY(-10px); }
        }

        .emoji-btn::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: radial-gradient(circle, rgba(255,255,255,0.3) 0%, transparent 70%);
            transform: scale(0);
            transition: transform 0.6s ease-out;
        }

        .emoji-btn:hover::before {
            transform: scale(1);
        }

        .emoji-btn:hover {
            transform: scale(1.3) rotate(15deg) translateY(-10px);
            box-shadow: 0 15px 35px rgba(0,0,0,0.3);
            animation: none;
        }

        .emoji-btn:active {
            transform: scale(1.1) rotate(0deg);
        }

        .emoji-btn.selected {
            border-color: #667eea;
            background: linear-gradient(135deg, #a29bfe 0%, #6c5ce7 100%);
            transform: scale(1.2);
            animation: wiggle 0.5s ease-in-out, float 3s ease-in-out infinite;
            box-shadow: 0 10px 30px rgba(102, 126, 234, 0.5);
        }

        @keyframes wiggle {
            0%, 100% { transform: rotate(0deg) scale(1.2); }
            25% { transform: rotate(-15deg) scale(1.25); }
            75% { transform: rotate(15deg) scale(1.25); }
        }

        .emoji-btn .emoji-icon {
            display: inline-block;
            transition: transform 0.3s ease;
        }

        .emoji-btn:nth-child(1):hover .emoji-icon,
        .emoji-btn:nth-child(1).selected .emoji-icon {
            animation: happyJump 0.6s ease infinite;
        }

        @keyframes happyJump {
            0%, 100% { transform: translateY(0) scale(1); }
            50% { transform: translateY(-15px) scale(1.2); }
        }

        .emoji-btn:nth-child(2):hover .emoji-icon,
        .emoji-btn:nth-child(2).selected .emoji-icon {
            animation: sadDrop 1.5s ease infinite;
        }

        @keyframes sadDrop {
            0%, 100% { transform: translateY(0) scale(1); }
            50% { transform: translateY(8px) scale(0.95); }
        }

        .emoji-btn:nth-child(3):hover .emoji-icon,
        .emoji-btn:nth-child(3).selected .emoji-icon {
            animation: tiredSway 2s ease-in-out infinite;
        }

        @keyframes tiredSway {
            0%, 100% { transform: rotate(0deg) translateX(0); }
            25% { transform: rotate(-8deg) translateX(-5px); }
            75% { transform: rotate(8deg) translateX(5px); }
        }

        .emoji-btn:nth-child(4):hover .emoji-icon,
        .emoji-btn:nth-child(4).selected .emoji-icon {
            animation: scaredShake 0.3s ease infinite;
        }

        @keyframes scaredShake {
            0%, 100% { transform: translateX(0) scale(1); }
            25% { transform: translateX(-4px) scale(0.95); }
            75% { transform: translateX(4px) scale(0.95); }
        }

        .emoji-btn:nth-child(5):hover .emoji-icon,
        .emoji-btn:nth-child(5).selected .emoji-icon {
            animation: excitedBounce 0.5s ease infinite;
        }

        @keyframes excitedBounce {
            0%, 100% { transform: scale(1) rotate(0deg); }
            25% { transform: scale(1.2) rotate(-10deg); }
            75% { transform: scale(1.2) rotate(10deg); }
        }

        .emoji-btn:nth-child(6):hover .emoji-icon,
        .emoji-btn:nth-child(6).selected .emoji-icon {
            animation: angryShake 0.4s ease infinite;
        }

        @keyframes angryShake {
            0%, 100% { transform: rotate(0deg) scale(1); }
            25% { transform: rotate(-12deg) scale(1.1); }
            75% { transform: rotate(12deg) scale(1.1); }
        }

        .emoji-label {
            display: block;
            font-size: 14px;
            margin-top: 8px;
            font-weight: 600;
            color: #333;
        }

        .action-buttons {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            margin-top: 20px;
        }

        .btn {
            padding: 15px 30px;
            border: none;
            border-radius: 10px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
            overflow: hidden;
        }

        .btn::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 0;
            height: 0;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.3);
            transform: translate(-50%, -50%);
            transition: width 0.5s, height 0.5s;
        }

        .btn:hover::before {
            width: 300px;
            height: 300px;
        }

        .btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            box-shadow: 0 4px 15px rgba(102, 126, 234, 0.3);
        }

        .btn-primary:hover {
            transform: translateY(-3px) scale(1.02);
            box-shadow: 0 8px 25px rgba(102, 126, 234, 0.5);
        }

        .btn-primary:active {
            transform: translateY(-1px) scale(0.98);
        }

        .btn-checkin {
            background: linear-gradient(135deg, #10b981 0%, #059669 100%);
            color: white;
            box-shadow: 0 4px 15px rgba(16, 185, 129, 0.3);
        }

        .btn-checkin:hover {
            transform: translateY(-3px) scale(1.02);
            box-shadow: 0 8px 25px rgba(16, 185, 129, 0.5);
        }

        .btn-checkin:active {
            transform: translateY(-1px) scale(0.98);
        }

        .btn-checkout {
            background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%);
            color: white;
            box-shadow: 0 4px 15px rgba(239, 68, 68, 0.3);
        }

        .btn-checkout:hover {
            transform: translateY(-3px) scale(1.02);
            box-shadow: 0 8px 25px rgba(239, 68, 68, 0.5);
        }

        .btn-checkout:active {
            transform: translateY(-1px) scale(0.98);
        }

        .btn-secondary {
            background: linear-gradient(135deg, #e0e0e0 0%, #d0d0d0 100%);
            color: #333;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
        }

        .btn-secondary:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(0, 0, 0, 0.15);
        }

        .success-message {
            text-align: center;
            padding: 20px;
            animation: successFadeIn 0.5s ease;
        }

        @keyframes successFadeIn {
            from {
                opacity: 0;
                transform: translateY(30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .success-icon {
            font-size: 80px;
            margin-bottom: 20px;
            animation: successBounce 1s ease infinite;
            display: inline-block;
        }

        @keyframes successBounce {
            0%, 100% {
                transform: scale(1) rotate(0deg);
            }
            25% {
                transform: scale(1.2) rotate(-10deg);
            }
            75% {
                transform: scale(1.2) rotate(10deg);
            }
        }

        .success-text {
            font-size: 24px;
            color: #333;
            margin-bottom: 10px;
            animation: textSlideIn 0.6s ease 0.2s both;
        }

        @keyframes textSlideIn {
            from {
                opacity: 0;
                transform: translateX(-30px);
            }
            to {
                opacity: 1;
                transform: translateX(0);
            }
        }

        .success-details {
            color: #666;
            margin-bottom: 20px;
            animation: textSlideIn 0.6s ease 0.4s both;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 20px;
            margin-bottom: 25px;
        }

        .stat-card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 25px;
            border-radius: 15px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
            overflow: hidden;
        }

        .stat-card::before {
            content: '';
            position: absolute;
            top: -50%;
            right: -50%;
            width: 200%;
            height: 200%;
            background: radial-gradient(circle, rgba(255,255,255,0.1) 0%, transparent 70%);
            transform: scale(0);
            transition: transform 0.6s ease;
        }

        .stat-card:hover::before {
            transform: scale(1);
        }

        .stat-card:hover {
            transform: translateY(-5px) scale(1.02);
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
        }

        .stat-card h3 {
            font-size: 14px;
            margin-bottom: 10px;
            opacity: 0.9;
        }

        .stat-card .number {
            font-size: 36px;
            font-weight: bold;
            animation: numberCount 1s ease;
        }

        @keyframes numberCount {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .chart-section {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 25px;
            margin-bottom: 25px;
        }

        .chart-card {
            background: #f9fafb;
            padding: 25px;
            border-radius: 15px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
        }

        .chart-card h3 {
            color: #667eea;
            margin-bottom: 20px;
            font-size: 18px;
        }

        #emojiChart {
            max-width: 300px;
            margin: 0 auto;
        }

        .attendance-list {
            background: #f9fafb;
            padding: 25px;
            border-radius: 15px;
            max-height: 280px;
            overflow-y: auto;
            min-height: 280px;
            display: flex;
            flex-direction: column;
        }

        .attendance-list h3 {
            color: #667eea;
            margin-bottom: 20px;
            font-size: 18px;
        }

        .attendance-item {
            background: white;
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 10px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: 0 2px 5px rgba(0,0,0,0.05);
            transition: all 0.3s ease;
            animation: slideInRight 0.4s ease;
        }

        @keyframes slideInRight {
            from {
                opacity: 0;
                transform: translateX(30px);
            }
            to {
                opacity: 1;
                transform: translateX(0);
            }
        }

        .attendance-item:hover {
            transform: translateX(5px);
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
        }

        .attendance-item.checkin {
            border-left: 4px solid #10b981;
        }

        .attendance-item.checkout {
            border-left: 4px solid #ef4444;
        }

        .download-section {
            display: flex;
            justify-content: flex-end;
            gap: 15px;
            margin-bottom: 25px;
        }

        .btn-download {
            padding: 12px 25px;
            border: none;
            border-radius: 10px;
            font-size: 15px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            gap: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        .btn-excel {
            background: linear-gradient(135deg, #10b981 0%, #059669 100%);
            color: white;
        }

        .btn-excel:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(16, 185, 129, 0.4);
        }

        .btn-pdf {
            background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%);
            color: white;
        }

        .btn-pdf:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(239, 68, 68, 0.4);
        }

        .error {
            color: #ef4444;
            font-size: 14px;
            margin-top: 5px;
        }

        /* Tablet Mode */
        @media (max-width: 1024px) and (min-width: 769px) {
            .container {
                max-width: 850px;
                height: 80vh;
            }
            
            .dashboard-container {
                max-width: 1200px;
                height: 85vh;
            }
            
            .name-grid {
                grid-template-columns: repeat(3, 1fr);
                gap: 12px;
            }
            
            .emoji-grid {
                grid-template-columns: repeat(3, 1fr);
                gap: 15px;
            }
            
            .emoji-btn {
                padding: 25px;
                font-size: 50px;
            }
            
            .stats-grid {
                grid-template-columns: repeat(2, 1fr);
                gap: 15px;
            }
            
            .chart-section {
                grid-template-columns: 1fr;
                gap: 20px;
            }
        }

        /* Mobile Mode */
        @media (max-width: 768px) {
            body {
                padding: 10px;
            }
            
            .nav-tabs {
                flex-direction: column;
                gap: 8px;
            }
            
            .tab-btn {
                padding: 12px 30px;
                font-size: 15px;
            }
            
            .container {
                padding: 25px 30px;
                width: 95vw;
                height: 80vh;
            }
            
            .dashboard-container {
                padding: 25px 30px;
                width: 95vw;
                height: 85vh;
            }
            
            .school-logo {
                top: 15px;
                left: 20px;
                gap: 8px;
            }
            
            .school-logo-icon {
                width: 40px;
                height: 40px;
            }
            
            .school-name-main {
                font-size: 14px;
            }
            
            .school-name-sub {
                font-size: 11px;
            }
            
            h1 {
                font-size: 24px;
                margin-top: 20px;
                margin-bottom: 20px;
            }
            
            label {
                font-size: 16px;
                margin-bottom: 12px;
            }
            
            .name-grid {
                grid-template-columns: repeat(2, 1fr);
                gap: 10px;
                max-height: 350px;
            }
            
            .name-btn {
                padding: 15px 10px;
                font-size: 15px;
            }
            
            .emoji-grid {
                grid-template-columns: repeat(3, 1fr);
                gap: 12px;
            }
            
            .emoji-btn {
                padding: 20px;
                font-size: 40px;
            }
            
            .emoji-label {
                font-size: 12px;
            }
            
            .btn {
                padding: 12px 20px;
                font-size: 15px;
            }
            
            .stats-grid {
                grid-template-columns: repeat(2, 1fr);
                gap: 12px;
            }
            
            .stat-card {
                padding: 18px;
            }
            
            .stat-card h3 {
                font-size: 12px;
            }
            
            .stat-card .number {
                font-size: 28px;
            }
            
            .chart-section {
                grid-template-columns: 1fr;
                gap: 15px;
            }
            
            .chart-card {
                padding: 18px;
            }
            
            .chart-card h3 {
                font-size: 16px;
            }
            
            .attendance-list {
                padding: 18px;
                max-height: 200px;
            }
            
            .attendance-list h3 {
                font-size: 16px;
            }
            
            .download-section {
                flex-direction: column;
                gap: 10px;
            }
            
            .btn-download {
                justify-content: center;
                width: 100%;
            }
            
            .success-icon {
                font-size: 60px;
            }
            
            .success-text {
                font-size: 20px;
            }
        }

        /* Small Mobile */
        @media (max-width: 480px) {
            .container {
                padding: 20px 15px;
                height: 85vh;
            }
            
            .dashboard-container {
                padding: 20px 15px;
                height: 88vh;
            }
            
            h1 {
                font-size: 20px;
            }
            
            .name-grid {
                grid-template-columns: 1fr;
                gap: 8px;
            }
            
            .emoji-grid {
                grid-template-columns: repeat(2, 1fr);
                gap: 10px;
            }
            
            .emoji-btn {
                padding: 18px;
                font-size: 35px;
            }
            
            .stats-grid {
                grid-template-columns: 1fr;
                gap: 10px;
            }
        }
    </style>
</head>
<body>
    <!-- Logo Transition Overlay -->
    <div class="logo-transition-overlay" id="logoTransition">
        <img src="OIP.webp" alt="Logo SD Lazuardi">
    </div>

    <div class="nav-tabs">
        <button class="tab-btn active" onclick="switchPage('student')">Absensi Siswa</button>
        <button class="tab-btn" onclick="switchPage('teacher')">Dashboard Guru</button>
    </div>

    <!-- Halaman Absensi Siswa -->
    <div class="page active" id="studentPage">
        <div class="container">
            <div class="school-logo">
                <div class="school-logo-icon">
                    <img src="OIP.webp" alt="Logo SD Lazuardi">
                </div>
                <div class="school-name">
                    <div class="school-name-main">SD Lazuardi</div>
                    <div class="school-name-sub">Depok</div>
                </div>
            </div>
            
            <h1>üìö Absensi Siswa</h1>
            
            <!-- Step 1: Pilih Nama -->
            <div class="step active" id="step1">
                <label>Pilih Nama Anda:</label>
                <div class="name-grid" id="nameGrid"></div>
                <p class="error" id="nameError"></p>
            </div>

            <!-- Step 2: Pilih Emoji -->
            <div class="step" id="step2">
                <label>Bagaimana perasaan Anda hari ini?</label>
                <div class="emoji-grid">
                    <button class="emoji-btn" onclick="selectEmoji('üòä Happy', this)">
                        <span class="emoji-icon">üòä</span>
                        <span class="emoji-label">Happy</span>
                    </button>
                    <button class="emoji-btn" onclick="selectEmoji('üò¢ Sad', this)">
                        <span class="emoji-icon">üò¢</span>
                        <span class="emoji-label">Sad</span>
                    </button>
                    <button class="emoji-btn" onclick="selectEmoji('üò¥ Tired', this)">
                        <span class="emoji-icon">üò¥</span>
                        <span class="emoji-label">Tired</span>
                    </button>
                    <button class="emoji-btn" onclick="selectEmoji('üò± Scared', this)">
                        <span class="emoji-icon">üò±</span>
                        <span class="emoji-label">Scared</span>
                    </button>
                    <button class="emoji-btn" onclick="selectEmoji('ü§© Excited', this)">
                        <span class="emoji-icon">ü§©</span>
                        <span class="emoji-label">Excited</span>
                    </button>
                    <button class="emoji-btn" onclick="selectEmoji('üò† Angry', this)">
                        <span class="emoji-icon">üò†</span>
                        <span class="emoji-label">Angry</span>
                    </button>
                </div>
                <p class="error" id="emojiError"></p>
                <div class="action-buttons">
                    <button class="btn btn-secondary" onclick="backToName()">Kembali</button>
                    <button class="btn btn-primary" onclick="nextToAction()">Lanjut</button>
                </div>
            </div>

            <!-- Step 3: Check In / Check Out -->
            <div class="step" id="step3">
                <label>Pilih Tindakan:</label>
                <div class="action-buttons">
                    <button class="btn btn-checkin" onclick="submitAttendance('Check In')">‚úÖ Check In</button>
                    <button class="btn btn-checkout" onclick="submitAttendance('Check Out')">üö™ Check Out</button>
                </div>
                <button class="btn btn-secondary" style="width: 100%; margin-top: 15px;" onclick="backToEmoji()">Kembali</button>
            </div>

            <!-- Step 4: Success -->
            <div class="step" id="step4">
                <div class="success-message">
                    <div class="success-icon">‚úÖ</div>
                    <div class="success-text" id="successText"></div>
                    <div class="success-details" id="successDetails"></div>
                </div>
            </div>
        </div>
    </div>

    <!-- Halaman Dashboard Guru -->
    <div class="page" id="teacherPage">
        <div class="dashboard-container">
            <div class="school-logo">
                <div class="school-logo-icon">
                    <img src="OIP.webp" alt="Logo SD Lazuardi">
                </div>
                <div class="school-name">
                    <div class="school-name-main">SD Lazuardi</div>
                    <div class="school-name-sub">Depok</div>
                </div>
            </div>
            
            <h1>üë®‚Äçüè´ Dashboard Guru</h1>

            <div class="download-section">
                <button class="btn-download btn-excel" onclick="downloadExcel()">
                    üìä Download Excel
                </button>
                <button class="btn-download btn-pdf" onclick="downloadPDF()">
                    üìÑ Download PDF
                </button>
            </div>
            
            <div class="stats-grid">
                <div class="stat-card">
                    <h3>Total Siswa</h3>
                    <div class="number" id="totalStudents">30</div>
                </div>
                <div class="stat-card" style="background: linear-gradient(135deg, #10b981 0%, #059669 100%);">
                    <h3>Sudah Check In</h3>
                    <div class="number" id="checkedIn">0</div>
                </div>
                <div class="stat-card" style="background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%);">
                    <h3>Sudah Check Out</h3>
                    <div class="number" id="checkedOut">0</div>
                </div>
                <div class="stat-card" style="background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%);">
                    <h3>Kehadiran Hari Ini</h3>
                    <div class="number" id="attendanceRate">0%</div>
                </div>
            </div>

            <div class="chart-section">
                <div class="chart-card">
                    <h3>üìä Status Absensi</h3>
                    <canvas id="attendanceChart"></canvas>
                </div>
                <div class="chart-card">
                    <h3>üòä Distribusi Mood Siswa</h3>
                    <canvas id="emojiChart"></canvas>
                </div>
            </div>

            <div class="attendance-list">
                <h3>üìã Riwayat Absensi Hari Ini</h3>
                <div id="attendanceHistory"></div>
            </div>
        </div>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script>
        // Daftar nama siswa SD
        const studentNames = [
            'Ahmad Rizky', 'Alya Putri', 'Bima Sakti', 'Chelsea Vania',
            'Daffa Akbar', 'Elsa Cantika', 'Faiz Akmal', 'Gita Anindya',
            'Haikal Farhan', 'Inara Salma', 'Jihan Zahra', 'Kenzo Aditya',
            'Luna Azzahra', 'Mikha Ardian', 'Naura Syifa', 'Ozzy Pratama',
            'Putri Anisa', 'Rafa Mahendra', 'Sakura Dewi', 'Tara Amelia',
            'Umar Fadhil', 'Valen Citra', 'Wahyu Fikri', 'Xaviera Aulia',
            'Yusuf Hakim', 'Zayn Malik', 'Aira Putri', 'Bryan Adiputra',
            'Clara Safira', 'Daffa Ramadhan'
        ];

        let currentStep = 1;
        let studentName = '';
        let selectedEmoji = '';
        let attendanceHistory = [];
        let checkedInStudents = {};
        let checkedOutStudents = {};

        // Chart objects
        let attendanceChart = null;
        let emojiChart = null;

        // Fungsi untuk convert emoji ke text untuk PDF
        function emojiToText(emojiString) {
            const emojiMap = {
                'üòä Happy': 'Happy',
                'üò¢ Sad': 'Sad',
                'üò¥ Tired': 'Tired',
                'üò± Scared': 'Scared',
                'ü§© Excited': 'Excited',
                'üò† Angry': 'Angry'
            };
            return emojiMap[emojiString] || emojiString;
        }

        // Load data dari storage saat halaman dimuat
        async function loadDataFromStorage() {
            try {
                const today = new Date().toLocaleDateString('id-ID');
                
                // Load attendance history
                const historyResult = await window.storage.get('attendance-history');
                if (historyResult && historyResult.value) {
                    const data = JSON.parse(historyResult.value);
                    if (data.date === today) {
                        attendanceHistory = data.records;
                    } else {
                        // Data dari hari sebelumnya, reset
                        attendanceHistory = [];
                        checkedInStudents = {};
                        checkedOutStudents = {};
                        await saveDataToStorage();
                    }
                }
                
                // Load checked in students
                const checkinResult = await window.storage.get('checked-in-students');
                if (checkinResult && checkinResult.value) {
                    const data = JSON.parse(checkinResult.value);
                    if (data.date === today) {
                        checkedInStudents = data.students;
                    }
                }
                
                // Load checked out students
                const checkoutResult = await window.storage.get('checked-out-students');
                if (checkoutResult && checkoutResult.value) {
                    const data = JSON.parse(checkoutResult.value);
                    if (data.date === today) {
                        checkedOutStudents = data.students;
                    }
                }
                
                console.log('Data loaded successfully');
                updateNameButtonStates();
            } catch (error) {
                console.log('No previous data or error loading:', error);
                attendanceHistory = [];
                checkedInStudents = {};
                checkedOutStudents = {};
            }
        }

        // Save data ke storage
        async function saveDataToStorage() {
            try {
                const today = new Date().toLocaleDateString('id-ID');
                
                await window.storage.set('attendance-history', JSON.stringify({
                    date: today,
                    records: attendanceHistory
                }));
                
                await window.storage.set('checked-in-students', JSON.stringify({
                    date: today,
                    students: checkedInStudents
                }));
                
                await window.storage.set('checked-out-students', JSON.stringify({
                    date: today,
                    students: checkedOutStudents
                }));
                
                console.log('Data saved successfully');
            } catch (error) {
                console.error('Error saving data:', error);
            }
        }

        // Switch between pages with logo animation
        function switchPage(page) {
            const currentPage = document.querySelector('.page.active');
            const logoOverlay = document.getElementById('logoTransition');
            
            logoOverlay.classList.add('active');
            
            setTimeout(() => {
                if (currentPage) {
                    currentPage.classList.remove('active');
                }
                
                document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
                
                if (page === 'student') {
                    document.getElementById('studentPage').classList.add('active');
                    document.querySelectorAll('.tab-btn')[0].classList.add('active');
                } else {
                    document.getElementById('teacherPage').classList.add('active');
                    document.querySelectorAll('.tab-btn')[1].classList.add('active');
                    updateDashboard();
                }
                
                setTimeout(() => {
                    logoOverlay.classList.remove('active');
                }, 200);
            }, 250);
        }

        // Load nama siswa
        function loadStudentNames() {
            const nameGrid = document.getElementById('nameGrid');
            studentNames.forEach(name => {
                const btn = document.createElement('button');
                btn.className = 'name-btn';
                btn.textContent = name;
                btn.onclick = () => selectName(name, btn);
                nameGrid.appendChild(btn);
            });
            
            updateNameButtonStates();
        }
        
        function updateNameButtonStates() {
            const nameButtons = document.querySelectorAll('.name-btn');
            nameButtons.forEach(btn => {
                const name = btn.textContent.split('\n')[0];
                
                btn.style.opacity = '1';
                btn.style.pointerEvents = 'auto';
                btn.style.background = '#f5f5f5';
                btn.innerHTML = name;
                
                const hasCheckedIn = checkedInStudents[name];
                const hasCheckedOut = checkedOutStudents[name];
                
                if (hasCheckedIn && hasCheckedOut) {
                    btn.style.opacity = '0.5';
                    btn.style.pointerEvents = 'none';
                    btn.style.background = '#e0e0e0';
                    btn.innerHTML = name + '<br><small style="font-size: 11px; color: #10b981;">‚úì Check In & Out</small>';
                } else if (hasCheckedOut) {
                    btn.innerHTML = name + '<br><small style="font-size: 11px; color: #ef4444;">‚úì Check Out</small>';
                } else if (hasCheckedIn) {
                    btn.innerHTML = name + '<br><small style="font-size: 11px; color: #f59e0b;">‚úì Check In</small>';
                }
            });
        }

        function selectName(name, btn) {
            if (checkedInStudents[name] && checkedOutStudents[name]) {
                alert(`${name} sudah melakukan Check In dan Check Out hari ini!`);
                return;
            }
            
            document.querySelectorAll('.name-btn').forEach(b => b.classList.remove('selected'));
            btn.classList.add('selected');
            studentName = name;
            document.getElementById('nameError').textContent = '';
            
            setTimeout(() => {
                showStep(2);
            }, 200);
        }

        function showStep(step) {
            const currentStepEl = document.querySelector('.step.active');
            if (currentStepEl) {
                currentStepEl.classList.remove('active');
            }
            
            setTimeout(() => {
                document.getElementById('step' + step).classList.add('active');
                currentStep = step;
            }, 150);
        }

        function selectEmoji(emoji, btn) {
            document.querySelectorAll('.emoji-btn').forEach(b => b.classList.remove('selected'));
            btn.classList.add('selected');
            selectedEmoji = emoji;
            document.getElementById('emojiError').textContent = '';
        }

        function nextToAction() {
            if (selectedEmoji === '') {
                document.getElementById('emojiError').textContent = 'Pilih emoji terlebih dahulu!';
                return;
            }
            showStep(3);
        }

        function submitAttendance(action) {
            if (action === 'Check In' && checkedInStudents[studentName]) {
                alert(`${studentName} sudah melakukan Check In! Silakan lakukan Check Out.`);
                return;
            }
            
            if (action === 'Check Out' && !checkedInStudents[studentName]) {
                alert(`${studentName} belum Check In! Silakan Check In terlebih dahulu.`);
                return;
            }
            
            if (action === 'Check Out' && checkedOutStudents[studentName]) {
                alert(`${studentName} sudah melakukan Check Out!`);
                return;
            }
            
            const now = new Date();
            const time = now.toLocaleTimeString('id-ID');
            const date = now.toLocaleDateString('id-ID');
            
            const record = {
                name: studentName,
                emoji: selectedEmoji,
                action: action,
                time: time,
                date: date,
                timestamp: now.getTime()
            };
            
            attendanceHistory.unshift(record);
            
            if (action === 'Check In') {
                checkedInStudents[studentName] = true;
            } else if (action === 'Check Out') {
                checkedOutStudents[studentName] = true;
            }
            
            saveDataToStorage();
            
            document.getElementById('successText').textContent = `${action} Berhasil!`;
            document.getElementById('successDetails').textContent = `${studentName} - ${selectedEmoji} pada ${time}`;
            showStep(4);
            
            setTimeout(() => {
                resetForm();
            }, 1500);
        }

        function resetForm() {
            document.querySelectorAll('.name-btn').forEach(b => b.classList.remove('selected'));
            document.querySelectorAll('.emoji-btn').forEach(b => b.classList.remove('selected'));
            studentName = '';
            selectedEmoji = '';
            updateNameButtonStates();
            showStep(1);
        }

        function backToName() {
            showStep(1);
        }

        function backToEmoji() {
            showStep(2);
        }

        // Dashboard Functions
        function updateDashboard() {
            const checkedInCount = Object.keys(checkedInStudents).length;
            const checkedOutCount = Object.keys(checkedOutStudents).length;
            const attendanceRate = Math.round((checkedInCount / studentNames.length) * 100);

            document.getElementById('totalStudents').textContent = studentNames.length;
            document.getElementById('checkedIn').textContent = checkedInCount;
            document.getElementById('checkedOut').textContent = checkedOutCount;
            document.getElementById('attendanceRate').textContent = attendanceRate + '%';

            updateAttendanceList();
            updateCharts();
        }

        function updateAttendanceList() {
            const historyDiv = document.getElementById('attendanceHistory');
            if (attendanceHistory.length === 0) {
                historyDiv.innerHTML = `
                    <div style="text-align: center; padding: 40px 20px;">
                        <div style="font-size: 48px; margin-bottom: 15px;">üìã</div>
                        <p style="color: #999; font-size: 16px; margin-bottom: 8px;">Belum ada data absensi hari ini</p>
                        <p style="color: #ccc; font-size: 14px;">Siswa dapat mulai melakukan absensi</p>
                    </div>
                `;
                return;
            }
            
            historyDiv.innerHTML = '';
            // Tampilkan dari yang pertama absen (tidak dibalik)
            const sortedHistory = [...attendanceHistory].reverse();
            
            sortedHistory.forEach(record => {
                const item = document.createElement('div');
                item.className = `attendance-item ${record.action === 'Check In' ? 'checkin' : 'checkout'}`;
                item.innerHTML = `
                    <div>
                        <strong>${record.name}</strong> ${record.emoji.split(' ')[0]}<br>
                        <small>${record.time}</small>
                    </div>
                    <div style="font-weight: 600; color: ${record.action === 'Check In' ? '#10b981' : '#ef4444'}">
                        ${record.action}
                    </div>
                `;
                historyDiv.appendChild(item);
            });
        }

        function updateCharts() {
            const checkedInCount = Object.keys(checkedInStudents).length;
            const checkedOutCount = Object.keys(checkedOutStudents).length;
            const notYet = studentNames.length - checkedInCount;

            if (attendanceChart) attendanceChart.destroy();
            if (emojiChart) emojiChart.destroy();

            const ctx1 = document.getElementById('attendanceChart').getContext('2d');
            attendanceChart = new Chart(ctx1, {
                type: 'doughnut',
                data: {
                    labels: ['Check In', 'Check Out', 'Belum Absen'],
                    datasets: [{
                        data: [checkedInCount, checkedOutCount, notYet],
                        backgroundColor: ['#10b981', '#ef4444', '#e5e7eb'],
                        borderWidth: 0
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: true,
                    plugins: {
                        legend: {
                            position: 'bottom',
                            labels: {
                                padding: 15,
                                font: {
                                    size: 12
                                }
                            }
                        }
                    }
                }
            });

            const emojiData = {};
            
            // Jika belum ada data, tampilkan placeholder
            if (attendanceHistory.length === 0) {
                emojiData['Belum Ada Data'] = 1;
            } else {
                attendanceHistory.forEach(record => {
                    const emoji = record.emoji.split(' ')[1];
                    emojiData[emoji] = (emojiData[emoji] || 0) + 1;
                });
            }

            const ctx2 = document.getElementById('emojiChart').getContext('2d');
            emojiChart = new Chart(ctx2, {
                type: 'pie',
                data: {
                    labels: Object.keys(emojiData),
                    datasets: [{
                        data: Object.values(emojiData),
                        backgroundColor: attendanceHistory.length === 0 
                            ? ['#e5e7eb'] 
                            : ['#fbbf24', '#ef4444', '#8b5cf6', '#ec4899', '#10b981', '#f97316'],
                        borderWidth: 0
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: true,
                    plugins: {
                        legend: {
                            position: 'bottom',
                            labels: {
                                padding: 15,
                                font: {
                                    size: 12
                                }
                            }
                        }
                    }
                }
            });
        }

        // Download Excel
        function downloadExcel() {
            if (attendanceHistory.length === 0) {
                alert('Belum ada data absensi untuk diunduh!');
                return;
            }

            let csvContent = "data:text/csv;charset=utf-8,\uFEFF";
            csvContent += "LAPORAN ABSENSI SD LAZUARDI DEPOK\n";
            csvContent += `Tanggal: ${new Date().toLocaleDateString('id-ID')}\n\n`;
            
            csvContent += "No,Nama Siswa,Perasaan,Status,Waktu,Tanggal\n";
            
            // Urutkan dari yang pertama absen (tidak dibalik)
            const sortedHistory = [...attendanceHistory].reverse();
            
            sortedHistory.forEach((record, index) => {
                const feeling = emojiToText(record.emoji);
                csvContent += `${index + 1},${record.name},${feeling},${record.action},${record.time},${record.date}\n`;
            });
            
            const checkedInCount = Object.keys(checkedInStudents).length;
            const checkedOutCount = Object.keys(checkedOutStudents).length;
            csvContent += `\n\nRINGKASAN:\n`;
            csvContent += `Total Siswa,${studentNames.length}\n`;
            csvContent += `Sudah Check In,${checkedInCount}\n`;
            csvContent += `Sudah Check Out,${checkedOutCount}\n`;
            csvContent += `Tingkat Kehadiran,${Math.round((checkedInCount / studentNames.length) * 100)}%\n`;
            
            const encodedUri = encodeURI(csvContent);
            const link = document.createElement("a");
            link.setAttribute("href", encodedUri);
            const fileName = `Absensi_SD_Lazuardi_${new Date().toLocaleDateString('id-ID').replace(/\//g, '-')}.csv`;
            link.setAttribute("download", fileName);
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
        }

        // Download PDF dengan logo dan statistik
        function downloadPDF() {
            if (attendanceHistory.length === 0) {
                alert('Belum ada data absensi untuk diunduh!');
                return;
            }

            const { jsPDF } = window.jspdf;
            const doc = new jsPDF();
            
            // Header dengan background
            doc.setFillColor(102, 126, 234);
            doc.rect(0, 0, 210, 45, 'F');
            
            // Add logo
            const logoImg = document.querySelector('.school-logo-icon img');
            if (logoImg && logoImg.complete) {
                try {
                    const canvas = document.createElement('canvas');
                    canvas.width = logoImg.naturalWidth;
                    canvas.height = logoImg.naturalHeight;
                    const ctx = canvas.getContext('2d');
                    ctx.drawImage(logoImg, 0, 0);
                    const logoData = canvas.toDataURL('image/png');
                    
                    // Add logo to PDF
                    doc.addImage(logoData, 'PNG', 15, 8, 25, 25);
                } catch (error) {
                    console.log('Logo could not be added:', error);
                }
            }
            
            // Title and subtitle
            doc.setTextColor(255, 255, 255);
            doc.setFontSize(22);
            doc.setFont(undefined, 'bold');
            doc.text("SD LAZUARDI DEPOK", 105, 18, { align: 'center' });
            
            doc.setFontSize(12);
            doc.setFont(undefined, 'normal');
            doc.text("Laporan Absensi Harian", 105, 28, { align: 'center' });
            
            const today = new Date();
            const dateOptions = { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' };
            const formattedDate = today.toLocaleDateString('id-ID', dateOptions);
            doc.text(formattedDate, 105, 37, { align: 'center' });
            
            doc.setTextColor(0, 0, 0);
            
            // Ringkasan Statistik dengan border yang lebih menarik
            doc.setFontSize(14);
            doc.setFont(undefined, 'bold');
            doc.text("Ringkasan Kehadiran", 105, 55, { align: 'center' });
            
            const checkedInCount = Object.keys(checkedInStudents).length;
            const checkedOutCount = Object.keys(checkedOutStudents).length;
            const attendanceRate = Math.round((checkedInCount / studentNames.length) * 100);
            
            // Box untuk statistik dengan shadow effect
            doc.setDrawColor(200, 200, 200);
            doc.setLineWidth(0.3);
            
            // Box kiri - Total & Status
            doc.setFillColor(250, 250, 250);
            doc.roundedRect(15, 62, 90, 40, 3, 3, 'FD');
            
            doc.setFontSize(11);
            doc.setFont(undefined, 'bold');
            doc.setTextColor(102, 126, 234);
            doc.text("TOTAL SISWA", 60, 70, { align: 'center' });
            doc.setFontSize(24);
            doc.text(studentNames.length.toString(), 60, 82, { align: 'center' });
            
            doc.setFontSize(10);
            doc.setTextColor(16, 185, 129);
            doc.text("Check In: " + checkedInCount, 22, 94);
            doc.setTextColor(239, 68, 68);
            doc.text("Check Out: " + checkedOutCount, 22, 100);
            
            // Box kanan - Persentase kehadiran (lebih besar)
            doc.setFillColor(102, 126, 234);
            doc.roundedRect(110, 62, 85, 40, 3, 3, 'FD');
            
            doc.setTextColor(255, 255, 255);
            doc.setFontSize(11);
            doc.setFont(undefined, 'bold');
            doc.text("TINGKAT KEHADIRAN", 152.5, 70, { align: 'center' });
            
            doc.setFontSize(32);
            doc.setFont(undefined, 'bold');
            doc.text(attendanceRate + "%", 152.5, 92, { align: 'center' });
            
            // Tabel Absensi
            doc.setTextColor(0, 0, 0);
            doc.setFontSize(14);
            doc.setFont(undefined, 'bold');
            doc.text("Daftar Absensi Siswa", 105, 115, { align: 'center' });
            
            // Header tabel dengan rounded corners effect
            doc.setFillColor(102, 126, 234);
            doc.roundedRect(15, 120, 180, 10, 2, 2, 'F');
            
            doc.setTextColor(255, 255, 255);
            doc.setFontSize(10);
            doc.setFont(undefined, 'bold');
            doc.text("No", 20, 127);
            doc.text("Nama Siswa", 35, 127);
            doc.text("Perasaan", 90, 127);
            doc.text("Status", 125, 127);
            doc.text("Waktu", 160, 127);
            
            // Data tabel
            doc.setTextColor(0, 0, 0);
            doc.setFont(undefined, 'normal');
            doc.setFontSize(9);
            
            let y = 138;
            let rowNumber = 1;
            
            // Urutkan dari yang pertama absen (tidak dibalik)
            const sortedHistory = [...attendanceHistory].reverse();
            
            sortedHistory.forEach((record, index) => {
                if (y > 270) {
                    doc.addPage();
                    y = 20;
                    
                    // Header tabel di halaman baru
                    doc.setFillColor(102, 126, 234);
                    doc.roundedRect(15, 15, 180, 10, 2, 2, 'F');
                    doc.setTextColor(255, 255, 255);
                    doc.setFontSize(10);
                    doc.setFont(undefined, 'bold');
                    doc.text("No", 20, 22);
                    doc.text("Nama Siswa", 35, 22);
                    doc.text("Perasaan", 90, 22);
                    doc.text("Status", 125, 22);
                    doc.text("Waktu", 160, 22);
                    
                    doc.setTextColor(0, 0, 0);
                    doc.setFont(undefined, 'normal');
                    doc.setFontSize(9);
                    y = 33;
                }
                
                // Zebra striping
                if (index % 2 === 0) {
                    doc.setFillColor(248, 250, 252);
                    doc.rect(15, y - 5, 180, 8, 'F');
                }
                
                doc.setTextColor(0, 0, 0);
                doc.text(rowNumber.toString(), 20, y);
                
                const studentNameText = record.name.substring(0, 25);
                doc.text(studentNameText, 35, y);
                
                const feelingText = emojiToText(record.emoji);
                doc.text(feelingText, 90, y);
                
                // Status dengan warna
                if (record.action === 'Check In') {
                    doc.setTextColor(16, 185, 129);
                    doc.setFont(undefined, 'bold');
                } else {
                    doc.setTextColor(239, 68, 68);
                    doc.setFont(undefined, 'bold');
                }
                doc.text(record.action, 125, y);
                
                doc.setTextColor(0, 0, 0);
                doc.setFont(undefined, 'normal');
                doc.text(record.time, 160, y);
                
                y += 8;
                rowNumber++;
            });
            
            // Footer di setiap halaman
            const pageCount = doc.internal.getNumberOfPages();
            for (let i = 1; i <= pageCount; i++) {
                doc.setPage(i);
                
                // Garis pembatas footer
                doc.setDrawColor(200, 200, 200);
                doc.setLineWidth(0.5);
                doc.line(20, 285, 190, 285);
                
                doc.setFontSize(8);
                doc.setTextColor(100, 100, 100);
                doc.text("Halaman " + i + " dari " + pageCount, 105, 290, { align: 'center' });
                
                const printTime = new Date().toLocaleString('id-ID');
                doc.text("Dicetak pada: " + printTime, 105, 294, { align: 'center' });
            }
            
            const now = new Date();
            const fileDate = now.toLocaleDateString('id-ID').replace(/\//g, '-');
            const fileName = "Laporan_Absensi_SD_Lazuardi_" + fileDate + ".pdf";
            doc.save(fileName);
        }

        // Check midnight reset setiap 1 menit
        async function checkMidnightReset() {
            const now = new Date();
            const hours = now.getHours();
            const minutes = now.getMinutes();
            
            // Jika sudah lewat tengah malam (00:00 - 00:01)
            if (hours === 0 && minutes === 0) {
                console.log('Midnight reset triggered');
                attendanceHistory = [];
                checkedInStudents = {};
                checkedOutStudents = {};
                await saveDataToStorage();
                updateNameButtonStates();
                
                // Jika ada di dashboard guru, update tampilan
                if (document.getElementById('teacherPage').classList.contains('active')) {
                    updateDashboard();
                }
            }
        }

        // Initialize
        loadStudentNames();
        
        // Load data saat halaman dimuat
        loadDataFromStorage();
        
        // Check midnight reset setiap 1 menit
        setInterval(checkMidnightReset, 60000);
    </script>
</body>
</html>
